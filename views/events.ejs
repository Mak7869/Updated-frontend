<% layout('layouts/boilerplate') -%>

<div class="max-w-7xl mx-auto px-6 py-8">
  <!-- Page Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-4xl font-bold text-gray-800 tracking-tight">
      ðŸ“… Events Dashboard
    </h1>

    <% if(user && user.ROLE === 'organizer') { %>
    <a
      href="/events/new"
      class="px-5 py-2 rounded-xl bg-indigo-600 text-white font-semibold shadow-md hover:bg-indigo-700 transition-all duration-300"
    >
      âž• Add New Event
    </a>
    <% } %>
  </div>

  <!-- Table Container -->
  <div
    class="bg-white shadow-xl rounded-2xl overflow-hidden border border-gray-200"
  >
    <table class="w-full text-left border-collapse">
      <thead class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
        <tr>
          <th class="py-4 px-5 text-sm font-semibold">ID</th>
          <th class="py-4 px-5 text-sm font-semibold">Name</th>
          <th class="py-4 px-5 text-sm font-semibold">Date</th>
          <th class="py-4 px-5 text-sm font-semibold">Location</th>
          <th class="py-4 px-5 text-sm font-semibold">Description</th>
          <th class="py-4 px-5 text-sm font-semibold">Actions</th>
        </tr>
      </thead>

      <tbody>
        <% events.forEach(event => { %> <% const isAttending =
        attendingEvents.includes(event.EVENT_ID); %> <% const isOrganizer = user
        && event.ORGANIZER_ID === user.USER_ID; %>

        <tr class="border-b hover:bg-gray-50 transition-all">
          <td class="py-4 px-5"><%= event.EVENT_ID %></td>
          <td class="py-4 px-5 font-medium text-gray-800">
            <%= event.EVENT_NAME %>
          </td>

          <td class="py-4 px-5">
            <%= event.EVENT_DATE ? new
            Date(event.EVENT_DATE).toISOString().slice(0,16).replace("T", " ") :
            "N/A" %>
          </td>

          <td class="py-4 px-5 text-gray-600"><%= event.LOCATION %></td>
          <td class="py-4 px-5 text-gray-600"><%= event.DESCRIPTION %></td>

          <td class="py-4 px-5 space-x-2">
            <% if(isOrganizer) { %>

            <!-- Edit -->
            <a
              href="/events/<%= event.EVENT_ID %>/edit"
              class="inline-block px-4 py-1.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-md transition"
            >
              Edit
            </a>

            <!-- View Attendees -->
            <a
              href="/events/<%= event.EVENT_ID %>/attendees"
              class="inline-block px-4 py-1.5 rounded-lg bg-gray-700 text-white hover:bg-gray-800 shadow-md transition"
            >
              Attendees
            </a>

            <!-- Delete -->
            <form
              action="/events/<%= event.EVENT_ID %>?_method=DELETE"
              method="POST"
              class="inline-block"
              onsubmit="return confirm('Delete this event?')"
            >
              <button
                class="px-4 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700 shadow-md transition"
              >
                Delete
              </button>
            </form>

            <% } else if(user && user.ROLE === 'attendee') { %> <%
            if(isAttending) { %>
            <!-- Leave Event -->
            <form
              action="/events/<%= event.EVENT_ID %>/leave"
              method="POST"
              class="inline-block"
              onsubmit="return confirm('Leave this event?')"
            >
              <button
                class="px-4 py-1.5 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 shadow-md transition"
              >
                Leave Event
              </button>
            </form>

            <% } else { %>

            <!-- Join -->
            <a
              href="/events/<%= event.EVENT_ID %>/join"
              class="inline-block px-4 py-1.5 rounded-lg bg-green-600 text-white hover:bg-green-700 shadow-md transition"
            >
              Join Event
            </a>

            <% } %> <% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
